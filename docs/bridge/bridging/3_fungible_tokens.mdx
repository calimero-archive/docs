---
title: How to bridge fungible tokens
sidebar_position: 3
---

The Fungible Token (FT) Connector enables the bridging of FTs between NEAR and Calimero. This guide provides step-by-step instructions on how to bridge FTs from NEAR Testnet to Calimero and back.

## Sending FTs to the ft_connector on NEAR

To bridge FTs from NEAR Testnet to Calimero, you need to initiate a single transaction to lock the desired amount of tokens in the `ft_connector` contract. This can be achieved by calling the `ft_transfer_call` function. It is important to note that when locking FTs on the source side FT Connector, you must use `ft_transfer_call` instead of `ft_transfer` to prevent token loss.

### CLI command example:

```bash
near call wrap.testnet ft_transfer_call --args '{"receiver_id":"ft_connector.cali99.dev.calimero.testnet","amount":"12345","msg":""}' --accountId igi.testnet --depositYocto 1 --gas 3000000000000
```

For a fully working JavaScript example, you can refer to the repository: [GitHub - calimero-is-near/calimero-examples: Examples for Calimero](https://github.com/calimero-is-near/calimero-examples/tree/master/bridging-fts)

Here's a short JavaScript snippet:

```javascript
const callFtTransferCallOnSource = {
  contractId: 'wrap.testnet',
  methodName: 'ft_transfer_call',
  args: {
    receiver_id: ftConnectorOnNearContractId,
    amount: amount,
    msg: 'testnet',
  },
  attachedDeposit: new big.BN('1'),
  gas: new big.BN(MAX_GAS_LIMIT),
};

const transferTokensTx = await senderAccount.functionCall(callFtTransferCallOnSource);
```

## Wrapped Tokens Naming

When a token is bridged, it is created as a deployer sub-account. The name of the bridged token follows a specific format to ensure uniqueness and compatibility. If the original FT on the source side is named `wrap.testnet` and the shard name is `cali99`, the bridged token name would be `wrap.ft_deployer.cali99.calimero.testnet`.

If the bridged token name exceeds the maximum allowed length of 64 characters (as per the NEAR protocol requirement), it will be shortened using the SHA256 hash algorithm. Only the first characters of the hash will be utilized to create a bridged token name that fits within the length limit.

For example, if the original token name is `cali_ft.testnet` and the shard name is `my-extremely-long-shard-name`, the resulting bridged token name would be `58aff6.ft_deployer.my-extremely-long-shard-name.calimero.testnet`. This name is derived by calculating the SHA256 hash of `cali_ft.ft_deployer.my-extremely-long-shard-name.calimero.testnet` and using the first characters of the hash to form the bridged token name.

## Withdraw FTs back to NEAR

To withdraw bridged tokens from Calimero back to NEAR, follow these steps:

### Burning FTs on Calimero

To initiate the withdrawal process, you need to call the `withdraw` function on the bridged token contract deployed on Calimero.

 This action will effectively burn the requested amount of tokens on Calimero. The bridge service will be notified of the burn event, and it will attempt to prove the burn on the ft connector contract on NEAR. Upon successful verification, the tokens will be unlocked and made available on NEAR Testnet.

### CLI command example:

```bash
calimero cali99-calimero-testnet call wrap.ft_deployer.cali99.calimero.testnet withdraw --args '{"amount":"345"}' --accountId igi.testnet --depositYocto 1 --gas 300000000000000
```

For a fully working JavaScript example, you can refer to the repository: [GitHub - calimero-is-near/calimero-examples: Examples for Calimero](https://github.com/calimero-is-near/calimero-examples/tree/master/bridging-fts)

Here's a short JavaScript snippet:

```javascript
const callWithdrawOnCalimero = {
  contractId: 'wrap.ft_deployer.cali99.calimero.testnet',
  methodName: 'withdraw',
  args: {
    amount: amount,
  },
  attachedDeposit: new big.BN('1'),
  gas: new big.BN(MAX_GAS_LIMIT),
};

const withdrawTokensTx = await senderAccount.functionCall(callWithdrawOnCalimero);
```

## Recap

In summary, we have transferred wrap fungible tokens from NEAR Testnet to the Calimero shard called `cali99`. This was done by locking the wNEAR coins on the source `ft_connector` contract. This action emitted an event signaling the locking of tokens. The Testnet-to-Calimero relayer and the bridge service picked up this event and validated the locking of tokens on NEAR and minted wrapped tokens on the Calimero shard.

Additionally, we have demonstrated how to withdraw wNEAR tokens back to NEAR Testnet. By calling the `withdraw` function on the FT token contract on Calimero, the requested amount of tokens was burned. This burn event was detected by the Calimero-to-Testnet relayer and the bridge service, which verified the burn on Calimero and released the tokens back to NEAR Testnet.

## Checking for FT balance

To check the fungible token balance on NEAR, use the following CLI command:

```bash
near view wrap.testnet ft_balance_of --args '{"account_id":"igi.testnet"}'
```

To check the fungible token balance on Calimero, use the following CLI command:

```bash
calimero cali99-calimero-testnet view wrap.ft_deployer.cali99.calimero.testnet ft_balance_of --args '{"account_id":"igi.testnet"}'
```

