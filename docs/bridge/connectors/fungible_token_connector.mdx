---
title: Fungible Token Connector
sidebar_position: 2
---

The fungible token connector in the Calimero bridge consists of four contracts: 
- ft_connector, 
- bridge_token_deployer, 
- bridge_token,
- permissions_manager.

To use the FT connector, these contracts need to be installed on both the NEAR Testnet and the Calimero shard.

:::info
Before proceeding to use the FT connector check and fulfill the [prerequisites for using the bridge](https://docs.calimero.network/bridge/bridging/prerequisites).
:::

## Setting up the ft_connectors

On the `ft_connector` contract, the contract owner needs to set the locker account, which refers to the `ft_connector` contract on the other chain. This information is used to verify that a transaction/receipt occurred on the corresponding `ft_connector` contract of the other network.

## Bridging FT from NEAR to Calimero (when the original token is on NEAR)

In this scenario, we are locking FTs on NEAR and minting wFT (wrapped FT) on Calimero.

1. Call `ft_transfer_call` on the FT contract on NEAR (lock on NEAR).
   - This step locks a fungible token on the NEAR side, where a user or DApp sends FTs to the `ft_connector` contract on NEAR.
2. Call NEAR RPC for transaction status.
   - Inside this transaction, the receipt contains an event denoting the lock, which will be proven on Calimero.
3. Call Calimero light client for the current height.
   - The `current_height` on the light client contract on Calimero needs to be higher than the block height where the lock of FTs occurred on the source chain.
4. Call NEAR RPC for light client proof.
   - This includes all the proof data from the archival node on NEAR needed to prove that the transaction passed successfully.
5. Call `mint()` on the Calimero `ft_connector`. The following steps occur:
   - If this is the first time transferring that FT, deploy the `bridge_token` on Calimero since wFT does not exist yet on Calimero.
   - Prove the outcome (fails if the proof is invalid). If proven, mint wFT on Calimero.
   - Use `get_metadata` for wFT on Calimero. If it is empty, use `get_metadata` on NEAR and `set_metadata` on Calimero.
   - Use `map_contract` on the NEAR `ft_connector` to map the Calimero FT contract with the NEAR FT contract.
6. Congratulations, wFT now exists on Calimero.

## Bridging back FT from Calimero to NEAR (burning the wrapped FT)

In this scenario, we are burning/withdrawing wFTs on Calimero and unlocking FTs on NEAR.

1. Call `view_mapping` on the `ft_connector` on Calimero to retrieve the name of the wFT since the transfer initiator might only know the FT name on NEAR.
2. Call `withdraw` on the wFT (bridge_token) on Calimero.
   - This transaction needs to be proven to show that it occurred.
   - This method burns the desired amount of wFT on Calimero.
3. Call Calimero RPC for transaction status.
   - We want to prove the receipt denoting the burn of a specific wFT with the given amount and to whom it should be unlocked on the NEAR side.
4. Call NEAR light client for the current height.
   - It needs to be higher than the block height where the withdrawal of wFTs occurred on the destination chain.
5

. Call Calimero RPC for light client proof.
6. Call `unlock()` on the NEAR `ft_connector` with the obtained proof and a valid block height.
   - Prove the outcome, and if proven, unlock FT on NEAR.
7. Congratulations, the FT is now unlocked on the source network.

## Bridging between Calimero and NEAR when the original asset is on Calimero

When the original asset is on Calimero, it means that it was initially minted on Calimero and never existed on NEAR. Bridging to NEAR in this case will result in a wrapped FT on NEAR. The steps from the previous two sections are applicable, but reversed.

## Automatic Bridging

All of these steps are automated with the Calimero Bridge service. Users or DApps only need to make a `ft_transfer_call` when locking FTs on a chain, and the bridge service will handle all the necessary steps. The wrapped asset will appear on the other chain. Similarly, when someone wants to unlock the funds, they simply need to make a `withdraw` call on the FT contract, and the bridge service will automatically handle the process, updating all the components automatically. The tokens will be unlocked on the other side if the tokens were burnt on the starting chain.